var CarCustomizer=function(){function E(e){return info.ismobile?e[0].value==c[0].value:e.hasClass("selected")}function S(e){var t;if(info.ismobile){if(typeof v[e.target.value]=="undefined")return!1;t=$(e.target).find("option:selected")}else t=$(e.target);if(i.call()&&!E(t)){i.acquire();var n=t.attr("cat");h=s.find("input:checked");if(!info.ismobile){t.addClass("selected");c.removeClass("selected")}else m.attr("data-category",n);c=t;if(h[0].value!=y[n]){h[0].checked=!1;h=p[y[n]];h[0].checked=!0}i.release()}return!1}function x(){n.updateMapCar(CarCustomizer.myCar[0].outerHTML);w.html(CarCustomizer.myCar[0].outerHTML)}function T(){if(typeof info!="undefined"){var t=""+y.shadow+y.wheels+y.spoiler+y.color+y.tint+y.decal;if(info.user.car_mods!=t){e.showSpinner("submit");$.ajax({url:"/api/car/customize",type:"post",data:{mods:t},success:function(n){if(n.status=="success"){info.user.car_mods=t;x()}e.hideSpinner("submit");e.hide()},error:function(t){e.hideSpinner("submit");e.hide()}})}else{e.hideSpinner("submit");e.hide()}}return!1}function N(t){var n=c.attr("cat"),r=t.value;if(r!=y[n]&&typeof e.myCarModel!="undefined"){if(n!="decal"&&n!="spoiler"||r!="1"){var i=new Image;i.onload=function(){b[n].attr("src",this.src);e.hideSpinner()};e.showSpinner();i.src="/media/carparts/"+e.myCarModel+"/"+n+"/"+r+".png"}else b[n].attr("src","");y[n]=r}return!1}function C(){if(typeof info!="undefined"&&info.user.car_mods!==null){var e=info.user.car_mods.split("");y.shadow=e[0];y.wheels=e[1];y.spoiler=e[2];y.color=e[3];y.tint=e[4];y.decal=e[5]}return!1}function k(){info.user.car!==null&&g.attr("src","/media/images/dashboard/customize/titles/"+info.user.car+".png")}if(arguments.callee._singletonInstance)return arguments.callee._singletonInstance;arguments.callee._singletonInstance=this;var e=this,t,n,r,i=new Semaphore,s,o,u,a,f,l,c,h,p={},d,v,m,g,y,b={},w;this.initialize=function(){s=$("#customize-modal");l=$("#customizer-loader-overlay");n=new Leaderboard;r=new SoundPlayer;o=s.find(".title .close");u=s.find(".apply-changes");f=s.find(".car-ctn");g=s.find("img.car-type-header");a=s.find(".modifications input[type=radio]");if(info.ismobile){m=s.find(".detail-ctr select");t=new Spinner({color:"#ddd",shadow:!0,top:"40%"})}else t=new Spinner({color:"#ddd",shadow:!0,top:"250",left:"450"});var i=info.user.week;d=s.find(".cat");if(typeof info!="undefined")if(info.ismobile){v={};var b=0;d.each(function(){if(b<i){v[this.value]=this.value;this.disabled=""}else switch(this.value){case"color":this.innerHTML+=" - Available January 31";break;case"tint":this.innerHTML+=" - Available February 10";break;case"wheels":this.innerHTML+=" - Available February 17";break;case"spoiler":this.innerHTML+=" - Available February 24";break;case"decal":this.innerHTML+=" - Available March 03";break;case"shadow":this.innerHTML+=" - Available March 10";break;default:}b++})}else d.filter(":lt("+i+")").addClass("enabled");a.each(function(){p[this.value]=$(this)});y={color:1,shadow:1,tint:1,spoiler:1,wheels:1,decal:1};info.ismobile?w=$(".customize-tout .car-ctn"):w=$(".customize-tout-ctr .car-ctn");c=d.filter(":first");o.on("click",function(){e.hide()});s.on("shown.bs.modal",function(){r.play(getSoundUrl(info.user.car))});if(info.ismobile){m.change(S);m.attr("data-category",c[0].cat)}else{c.addClass("selected");d.on("click",S)}s.on("hidden.bs.modal",C);u.on("click",T);a.click(function(e){!info.ismobile&&c.hasClass("enabled")||info.ismobile&&!c.attr("disabled")?N(this):e.preventDefault()});e.buildCar();h=p[y[c.attr("cat")]];typeof h!="undefined"&&h.click();s.find(".speaker").on("click",function(){r.play(getSoundUrl(info.user.car))})};this.buildCar=function(){function h(){c.release()}if(typeof info=="undefined")return;if(info.user.car===null||info.user.car_mods===null)return;C();k();var t=info.user.car_mods.split(""),n="";e.myCarModel="";switch(info.user.car.toString()){case"0":n="GranTorino";break;case"1":n="Shelby_GT500";break;case"2":n="Spyder_XR";break;case"3":n="2015_Ford_Mustang";break;case"4":n="Sports_GT";break;case"5":n="VeloSport_MG"}e.myCarModel=n;var r,i,s,o,u,a;i="/media/carparts/"+n+"/tint/"+t[4]+".png";s="/media/carparts/"+n+"/color/"+t[3]+".png";u="/media/carparts/"+n+"/wheels/"+t[1]+".png";a="/media/carparts/"+n+"/shadow/"+t[0]+".png";t[2]!=="1"?o="/media/carparts/"+n+"/spoiler/"+t[2]+".png":o="";t[5]!=="1"?r="/media/carparts/"+n+"/decal/"+t[5]+".png":r="";var l=$("<div class=mycar><div class='shadow'><img /></div><div class='wheels'><img /></div><div class='spoiler'><img /></div><div class='color'><img /></div><div class='tint'><img /></div><div class='decal'><img /></div>");typeof info!="undefined"&&info.ismobile&&l.append('<div class="empty-space"></div>');var c=new Semaphore(x);c.acquire(4);b.decal=l.find(".decal > img");if(r!==""){c.acquire();b.decal[0].onload=h}b.decal[0].src=r;b.tint=l.find(".tint > img");b.tint[0].onload=h;b.tint[0].src=i;b.color=l.find(".color > img");b.color[0].onload=h;b.color[0].src=s;b.spoiler=l.find(".spoiler > img");if(o!==""){c.acquire();b.spoiler[0].onload=h}b.spoiler[0].src=o;b.wheels=l.find(".wheels > img");b.wheels[0].onload=h;b.wheels[0].src=u;b.shadow=l.find(".shadow > img");b.shadow[0].onload=h;b.shadow[0].src=a;CarCustomizer.myCar=l;f.html(CarCustomizer.myCar)};this.setCarModel=function(t){s.addClass("car"+t);typeof info!="undefined"&&(info.user.car=t);e.buildCar()};this.show=function(){showModal(s,function(){r.play(getSoundUrl(info.user.car))})};this.hide=function(){hideModal(s)};this.showSpinner=function(e){typeof e=="undefined"&&(e="active");l.addClass(e);t.spin(l[0])};this.hideSpinner=function(e){e===null&&(e="active");l.removeClass(e);t.stop()}},customizer=new CarCustomizer;if(typeof executeOnLoad=="undefined")var executeOnLoad=[];executeOnLoad.push(function(){customizer.initialize()});