var activities={init:function(){(typeof info!="undefined"?info.ismobile:!1)?$(".notification-qty").on("click",function(e){activities.toggleNotifications(e)}):$("body").on("click",function(e){activities.toggleNotifications(e)});activities.initSpeedbump();activities.initWeeklyPrize();activities.initNotifications();activities.initSharePicture();activities.initShareVideo();activities.initShareActivities();activities.initLinkOut();activities.initCheckin()},initWeeklyPrize:function(){$(".carousel-ctr img").attr("src","/media/images/dashboard/prize-week"+info.user.week+".jpg")},initSharePicture:function(){$(".activity[activity-type=picture]").on("click",function(){var e=activities.findActivity($(this).attr("activity-type"),$(this).attr("activity-id")),t=$("#picture-modal");t.find(".facebook-share, .twitter-share, .tumblr-share").off();showModal(t);t.find("h1").text(e.title);t.find(".modal-content-ctr img").attr("src",e.photo);t.find(".facebook-share").on("click",function(){return!1});t.find(".twitter-share").on("click",function(){return!1;var t,n,r});t.find(".tumblr-share").on("click",function(){return!1;var t,n});t.find(".title .close").on("click",function(){hideModal(t)})});gaEvent("activity-picture-open")},initShareVideo:function(){$(".activity[activity-type=youtube]").on("click",function(){var e=activities.findActivity($(this).attr("activity-type"),$(this).attr("activity-id")),t=$("#youtube-modal");t.find(".facebook-share, .twitter-share, .tumblr-share").off();t.find("iframe").attr("src","//www.youtube.com/embed/"+e.youtubeid);t.find("h1").text(e.title);showModal(t);t.find(".facebook-share").on("click",function(){return!1});t.find(".twitter-share").on("click",function(){return!1;var t,n,r});t.find(".tumblr-share").on("click",function(){return!1;var t,n});t.find(".title .close").on("click",function(){hideModal(t)});$("#youtube-modal").on("hidden.bs.modal",function(e){t.find("iframe").attr("src","")})});gaEvent("activity-video-open")},completePhotoVideoShare:function(e,t){var n;t.activity_type=="picture"?n="/api/activity/pictureshare":t.activity_type=="youtube"&&(n="/api/activity/youtube");$.ajax({url:n,type:"POST",data:{aid:t.activityid,platform:e},complete:function(e,n){n=="success"&&dash.markActivityComplete(t.activity_type,t.activityid,t.pointvalue)}})},initShareActivities:function(){function c(){setTimeout(function(){$.ajax({url:"/api/activity/follow",type:"POST",data:{aid:r.activityid,activity_type:i},timeout:2e5,complete:function(e,t){t=="success"&&dash.markActivityComplete(r.activity_type,r.activityid,r.pointvalue)}})},e)}function h(){f.off();o.off();u.off();a.off()}function p(){return!1}function d(){return!1;var e,n,r}function v(){return!1;var e,n,s}var e=0,t="",n="",r,i,s=$("#follow-modal"),o=s.find(".facebook-share"),u=s.find(".twitter-share"),a=s.find(".tumblr-share"),f=s.find(".modal-content-ctr img"),l=s.find(".modal-content-ctr a");s.find(".title .close").on("click",function(){hideModal(s)});$(".activity[activity-type=fblike], .activity[activity-type=twitter], .activity[activity-type=tumblr]").on("click",function(){i=$(this).attr("activity-type");r=activities.findActivity(i,$(this).attr("activity-id"));h();s.find("h1").text(r.title);if(i=="fblike"||i=="twitter"||i=="tumblr")switch(i){case"fblike":t=r.fburl;n=r.fblikes_img_large;break;case"twitter":t=r.twitteraccount;n=r.twitters_img_large;break;case"tumblr":t=r.tumblraccount;n=r.tumblrs_img_large}f.attr("src",getMobilePath(n));l.attr("href",t);f.on("click",c);o.on("click",p);u.on("click",d);a.on("click",v);showModal(s);gaEvent("activity-follow-"+i+"-open")})},findActivity:function(e,t){var n;t?n=_.findWhere(info.activities,{activity_type:e,activityid:String(t)}):n=_.findWhere(info.activities,{activity_type:e});return _.isObject(n)?n:null},toggleNotifications:function(e){function s(){$.ajax({url:"/api/activity/history",success:function(e){activities.initNotifications(e.history)}})}var t=$(e.target),n=$("header .notification-well"),r=$("header .pin"),i=n.is(":visible");if(typeof info!="undefined"?info.ismobile:!1){n=$(".notification-well");if(t.hasClass("notification-qty")){showModal($("#notifications-modal"));n.fadeIn(250);r.fadeIn(250);s()}$("#notifications-modal .close").on("click",function(){n.fadeOut(250,function(){hideModal($("#notifications-modal"))});r.fadeOut(250)});return}if(i){if(t.hasClass("notification-qty")||t.parents(".notification-well").length===0&&!t.hasClass("notification-well")){n.hide();r.hide()}}else if(t.hasClass("notification-qty")){n.fadeIn(250);r.fadeIn(250);s()}},initNotifications:function(e){function a(e){$('<div class="notify-subhead">'+e+"</div>").appendTo(".notify-content")}function f(e,n){var r="";e==info.user.week&&(r="current-week");$('<div class="notify-item '+r+'">'+t[n.activity_type]+'<div class="points">+ '+numberWithCommas(n.pointvalue)+" pts</div></div>").appendTo(".notify-content")}var t={youtube:"Shared Video",twitter:"Twitter Follow",tumblr:"Tumblr Follow",texttrivia:"Movie Quiz",picture:"Shared Picture",phototrivia:"Photo Trivia",fblike:"Facebook Like",checkin:"Event Checkin",link:"Visited Link",recruit:"Recruited Friend",speedbump:"Speedbump",instagram:"Instagram Follow"},n=$(".notification-well").niceScroll();$(n.rail[0]).find("div").css({"background-color":"rgba(0, 0, 0, 0.6)",border:"none"});$(".notify-content").empty();var r=Number(info.user.week),i=info.history;e&&(i=e);if(i===!1){$('<div class="notify-item">No activities completed</div>').appendTo(".notify-content");return}$(".notification-qty").text(i[r-1].activities.length);var s,o=function(e,t){f(s+1,t)};for(s=r-1;s>=0;s--){var u="";s==r-1&&(u="current-week");s==r-1?a("This Week"):s==r-2?a("Last Week"):a("Week "+(s+1));i[s].activities.length==0&&$('<div class="notify-item '+u+'">No activities completed</div>').appendTo(".notify-content");$.each(i[s].activities,o)}},initLinkOut:function(){$(".activity[activity-type=link]").on("click",function(){var e=activities.findActivity($(this).attr("activity-type"),$(this).attr("activity-id"));window.open(e.linkout_url);$.ajax({url:"/api/activity/linkout",type:"POST",data:{aid:e.activityid},complete:function(t,n){n=="success"&&dash.markActivityComplete(e.activity_type,e.activityid,e.pointvalue)}})})},initSpeedbump:function(){var e=$("#speedbump-modal"),t=activities.findActivity("speedbump");if(t===null||info.user.car===null||e.length===0)return;if(t.speedbump_completed===!0||info.speedbump_complete===!0)return;e.find("img.speedbump-img").attr("src",getMobilePath(t.tout));e.find(".copy").text(t.speedbump_question);e.find(".choices .yes").text(t.yes_answer);e.find(".choices .no").text(t.no_answer);showModal(e);e.find(".btn").on("click",function(n){loadMask("#speedbump-modal");var r=$(n.target).attr("answer");$.ajax({url:"/api/activity/speedbump",type:"POST",data:{aid:t.activityid,a:r},complete:function(n,r){removeMask("#speedbump-modal");if(r=="success"){e.find(".choices").hide();e.find(".ok-btn-ctr").show();if(n.responseJSON.correct=="yes"){e.find(".copy").text(n.responseJSON.correct_response);e.find(".points span").text("+"+numberWithCommas(Number(t.pointvalue)));e.find(".points").addClass("correct")}else{e.find(".copy").text(n.responseJSON.incorrect_response);e.find(".points span").text("0");e.find(".points").addClass("incorrect")}dash.markActivityComplete(t.activity_type,t.activityid,t.pointvalue);info.speedbump_complete=!0;e.find(".watch-out").hide();e.find(".points").show();e.find(".copy").addClass("result");$(".btn").off("click");e.find(".ok-btn").on("click",function(){hideModal(e)})}else{alert("An error occurred. Please try again later.");hideModal(e)}}})})},initCheckin:function(){$(".activity").on("click",function(){var e=$(this).attr("activity-type"),t=activities.findActivity(e,$(this).attr("activity-id"));if(e=="checkin"){var n=$("#checkin-modal"),r=n.find(".virtual-tab"),i=n.find(".physical-tab"),s=n.find(".virtual-ctr"),o=n.find(".physical-ctr"),u=n.find(".physical-form-ctr");r.removeClass("active");i.addClass("active");u.hide();s.hide();o.show();n.find(".msg").text("");n.find(".toolbar h1").hide();n.find(".steps span.tag").text("#"+t.checkinhash);n.find(".virtual-ctr .image-ctr img.image").attr("src",t.checkin_share_img);showModal(n);i.on("click",function(){$(this).addClass("active");r.removeClass("active");o.show();u.hide();s.hide()});n.find(".virtual-tab").on("click",function(){$(this).addClass("active");i.removeClass("active");o.hide();u.hide();s.show()});n.find(".continue-btn").on("click",function(){o.hide();u.show()});n.find(".close-btn").on("click",function(){hideModal(n,h)});n.find(".screening-accordion").on("click",function(){n.find(".screening-ctr").toggleClass("collapsed")});n.find(".share-btn").on("click",function(e){var n=$(e.target).attr("platform");switch(n){case"facebook":a();break;case"twitter":f();break;case"tumblr":l()}$.ajax({url:"/api/activity/checkin",type:"POST",data:{aid:t.activityid,physical:"no",platform:n},complete:function(e,n){if(n){dash.markActivityComplete(t.activity_type,t.activityid,t.pointvalue);c("physical")}}})});function a(){return!1}function f(){return!1;var n,r}function l(){return!1;var n,r}function c(e){if(e=="physical"){n.find(".disabled").text("Physical event check-in has been disabled because you've already earned virtual check-in points this week. Check back next week for another chance to check in.");n.find("physical-ctr").hide()}else if(e=="virtual"){n.find(".disabled").text("Virtual event check-in has been disabled because you've already earned physical check-in points this week. Check back next week for another chance to check in.");n.find("virtual-ctr").hide()}n.find(".disabled").css({display:"table-cell"})}n.find(".check").on("click",function(e){var r,i,s=$(e.target).parent(".network-ctr");if(s.hasClass("instagram")){r=s.find("input[type=text]").val();i="instagram"}else if(s.hasClass("twitter")){r=s.find("input[type=text]").val();i="twitter"}n.find(".toolbar h1").hide();n.find(".error").text("");if(r===""){n.find(".toolbar h1").hide();n.find(".error").text("Please enter a valid username.");return}loadMask("#checkin-modal .modal-content");n.find(".title .tab").css({"pointer-events":"none"});$.ajax({url:"/api/activity/checkin",type:"POST",data:{aid:t.activityid,physical:"yes",platform:i,username:r},complete:function(e,r){removeMask("#checkin-modal .modal-content");n.find(".title .tab").css({"pointer-events":"auto"});if(r=="success")if(e.responseJSON.post_verified==0)n.find(".msg").addClass("error").text("Sorry, we were unable to verify your check-in. Please try again later.");else{n.find(".toolbar h1").show();dash.markActivityComplete(t.activity_type,t.activityid,t.pointvalue)}else n.find(".msg").addClass("error").text("Connection error. Please try again later.")}})});n.find(".close, .collect-btn").on("click",function(){hideModal(n,h)});n.on("hidden.bs.modal",h);function h(){n.find(".screening-accordion").off()}}})}};if(typeof executeOnLoad=="undefined")var executeOnLoad=[];executeOnLoad.push(function(){activities.init()});