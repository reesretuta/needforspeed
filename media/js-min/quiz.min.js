$(function(){function l(){s||a.spin(n)}function c(){s=!0;a.stop()}function h(n){n=="photo"?e.removeClass("text").addClass("photo"):e.removeClass("photo").addClass("text");i.removeClass("active");t.find("input:radio").removeClass("correct incorrect").attr("disabled",!1).prop("checked",!1);o.hide();t.find(".submit-btn").css({display:"block"});showModal(t)}function v(e,n,r){$.ajax("/api/activity/texttrivia",{type:"POST",data:{aid:u.activityid,a1:e.toLowerCase(),a2:n.toLowerCase(),a3:r.toLowerCase()},complete:function(e,n){c();if(n=="error"){E("Connection error. Please try again later.");return}if(e.responseJSON.answer){e.responseJSON.correct_count>0?E("Way to go! You get "+numberWithCommas(e.responseJSON.earned)+" points."):E("Better luck next time.");dash.markActivityComplete(u.activity_type,u.activityid,e.responseJSON.earned);for(var r=0;r<3;r++){var i=t.find("div.content.text input[name=q"+(r+1)+"-Answer]:checked"),s=e.responseJSON.answer[r].toUpperCase();i.attr("value")!=s&&t.find("div.content.text input[name=q"+(r+1)+"-Answer][value="+s+"]").addClass("incorrect")}}}})}function m(){for(var e=0;e<u.questions.length;e++){t.find(".text .question.q"+(e+1)).text(e+1+". "+u.questions[e].question);for(var n=0;n<u.questions[e].answers.length;n++){var r=["A","B","C","D"];t.find(".text .answers label[for=q"+(e+1)+"-"+r[n]+"]").text(r[n]+". "+u.questions[e].answers[n])}}}function g(e){var n=[];$.ajax("/api/activity/phototrivia",{type:"POST",data:{aid:u.activityid,a:e.toLowerCase()},complete:function(r,s){c();if(s=="error"){E("Connection error. Please try again later.");return}if(r.responseJSON.answer){n[0]=r.responseJSON.answer;if(e==r.responseJSON.answer.toUpperCase()){n[0]="Correct";E("Way to go! You get "+numberWithCommas(u.pointvalue)+" points.");dash.markActivityComplete(u.activity_type,u.activityid,u.pointvalue)}else{E("Better luck next time.");var o=t.find("div.content.photo input:checked"),a=r.responseJSON.answer.toUpperCase();o.attr("value")!=a&&t.find("div.content.photo input[value="+a+"]").addClass("incorrect");t.find(".photo input[type=radio][value="+r.responseJSON.answer+"]:not(checked)").addClass("incorrect");dash.markActivityComplete(u.activity_type,u.activityid,0)}i.attr("src",r.responseJSON.img_large).css({opacity:1})}}});return n}function y(){t.find(".photo .question.q1").text(u.question);t.find(".photo .answers label[for=photo-q1-A]").text("A. "+u.a);t.find(".photo .answers label[for=photo-q1-B]").text("B. "+u.b);t.find(".photo .answers label[for=photo-q1-C]").text("C. "+u.c);t.find(".photo .answers label[for=photo-q1-D]").text("D. "+u.d)}function b(){if(!N($(".text")))return;r.fadeOut(200,function(){$(this).addClass("inactive");$(this).removeAttr("style");l()});var e=[];e.q1=t.find(".text input[name=q1-Answer]:checked").val();e.q1=typeof e.q1=="undefined"?"":e.q1;e.q2=t.find(".text input[name=q2-Answer]:checked").val();e.q2=typeof e.q2=="undefined"?"":e.q2;e.q3=t.find(".text input[name=q3-Answer]:checked").val();e.q3=typeof e.q3=="undefined"?"":e.q3;v(e.q1,e.q2,e.q3)}function w(){if(!N($(".photo")))return;r.fadeOut(200,function(){$(this).addClass("inactive");$(this).removeAttr("style");l()});var e=t.find("div.content.photo input[name=q1-Answer]:checked").val();g(e)}function E(e){$("#quiz-footer").find(".submit-btn").fadeOut(250,function(){o.text(e).fadeIn(250)})}function S(){o.fadeOut(250,function(){o.text("");$("#quiz-footer").find(".submit-btn").fadeIn(250)})}function x(){t.find("input[type=radio]").attr("disabled",!0)}function T(){t.find("input[type=radio]").attr("disabled",!1)}function N(e){var t=e.find(".item:visible"),n=!1;$.each(t,function(e,t){var r=$(t).find("input[type=radio]"),i=!1;$.each(r,function(e,t){$(t).is(":checked")===!0&&(i=!0)});i===!1&&(n=!0)});if(n===!0){E("Please select an answer for every question");T();$("input").on("change",function(){S()});return!1}return!0}var e=$(".quiz"),t=$("#quiz-modal"),n=document.getElementById("quiz-footer"),r=t.find(".submit-btn"),i=t.find("div.media img.answer"),s=!1,o=t.find(".result-message"),u,a=new Spinner({color:"#ddd",shadow:!0}),f=function(){hideModal(t);c();return!1},p=function(){s=!1;h("photo");u=activities.findActivity($(this).attr("activity-type"),$(this).attr("activity-id"));$(".photo .media .hint").attr("src",u.img_small);y();return!1},d=function(){s=!1;h("quiz");u=activities.findActivity($(this).attr("activity-type"),$(this).attr("activity-id"));m();return!1};r.click(function(){x();e.hasClass("photo")?w():e.hasClass("text")&&b();return!1});t.find(".close").click(f);$(".activity[activity-type=texttrivia]").click(d);$(".activity[activity-type=phototrivia]").click(p)});