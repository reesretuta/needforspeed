var Dashboard=function(){if(arguments.callee._singletonInstance)return arguments.callee._singletonInstance;arguments.callee._singletonInstance=this};Dashboard.prototype=function(){var e=this,t,n,r,i,s,o,u,a=1;return{accessToken:null,crewPosition:0,init:function(){t=new CarCustomizer;r=new Leaderboard;typeof CarSelector=="function"&&(n=new CarSelector);s=$("header");i=s.find(".how-to-play-btn");u=s.find(".rank-val");info.ismobile?o=$("#dashboard").find("div.pts span"):o=s.find(".points-val");$(".hero1-facebook").on("mouseup",function(){return!1});$(".hero1-twitter").on("mouseup",function(){return!1});$(".tumblr-trailer").on("mouseup",function(){return!1});$(".twitter-trailer").on("mouseup",function(){return!1});$(".crew-ctr .leftcrew").on("mouseup",function(){dash.browseCrew("left");return!1});$(".crew-ctr .rightcrew").on("mouseup",function(){dash.browseCrew("right");return!1});$(".carousel-section a.trailer").on("click",function(){gaEvent("watch_trailer_dashboard")});$(".view-map-btn").click(function(){r.showLeaderboard();return!1});document.onkeydown=function(e){n!==null&&(e.keyCode=="39"?n.addClickToQueue("next"):e.keyCode=="37"&&n.addClickToQueue("prev"))};info.ismobile?$(".customize-tout").on("click",function(){closeMenu();t.show()}):$(".customize-tout-ctr").on("click",t.show);dash.initCrew();var e=new Date,a={year:2014,month:3,day:14,hour:17},f=new Date(a.year,a.month-1,a.day,a.hour);if(f>e){$(".countdown").show();var l=setInterval(function(){dash.countdownInit(a.year,a.month,a.day,a.hour)},1e3)}dash.getSocialFeed();dash.initTwitter();dash.initHowToPlay();dash.initRecruit()},initCrew:function(){if(info.crew.length>0){$(".crew-size span:first").text(info.crew.length);$(".crew-frame .profile-img").attr("src","//graph.facebook.com/"+info.crew[dash.crewPosition].fbid+"/picture?width=200&height=200")}$(".tach .week").text("Week "+info.user.week)},browseCrew:function(e){if(e=="right"){dash.crewPosition++;dash.crewPosition==info.crew.length&&(dash.crewPosition=0)}else if(e=="left"){dash.crewPosition--;dash.crewPosition==-1&&(dash.crewPosition=info.crew.length-1)}$(".crew-frame .profile-img").attr("src","//graph.facebook.com/"+info.crew[dash.crewPosition].fbid+"/picture?width=200&height=200")},initTwitter:function(){window.twttr=function(e,t,n){var r,i,s=e.getElementsByTagName(t)[0];if(e.getElementById(n))return;i=e.createElement(t);i.id=n;i.src="https://platform.twitter.com/widgets.js";s.parentNode.insertBefore(i,s);return window.twttr||(r={_e:[],ready:function(e){r._e.push(e)}})}(document,"script","twitter-wjs")},shareApp:function(e){return!1},shareTrailer:function(e){var t;if(e=="tumblr"){var n=encodeURIComponent("Enter the Need For Speed Movie Race, chance to win a trip for two to NY to attend a VIP Need For Speed event! Need For Speed - in theaters, March 2014");t=encodeURIComponent("https://www.youtube.com/watch?v=e73J71RZRn8");var r="http://www.tumblr.com/share/video?embed=%0A%20%20%20%20%20%20%20%20%20%20%20%20%3Ciframe%20src%3D%22http%3A%2F%2Fwww.youtube.com%2Fembed%2Fe73J71RZRn8%22%20width%3D%22600%22%20height%3D%22480%22%20title%3D%22YouTube%20video%20player%22%20frameborder%3D%220%22%20allowfullscreen%3D%22%22%3E%3C%2Fiframe%3E%0A%20%20%20%20%20%20%20%20&caption="+n;window.open(r,"_blank","width=600,height=400")}else{var i=encodeURIComponent("https://www.youtube.com/watch?v=e73J71RZRn8"),s=encodeURIComponent("Need For Speed - in theaters, March 2014");t="http://twitter.com/intent/tweet?url="+i+"&text="+s;window.open(t,"_blank","width=600,height=400")}$.ajax({url:"/api/nfs/sharetrailer",post:"get",data:"access_token="+access_token,success:function(){}})},countdownInit:function(e,t,n,r){var i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],s=new Date,o=s.getYear();o<1e3&&(o+=1900);var u=s.getMonth(),a=s.getDate(),f=s.getHours(),l=s.getMinutes(),c=s.getSeconds(),h=i[u]+" "+a+", "+o+" "+f+":"+l+":"+c;futurestring=i[t-1]+" "+n+", "+e+" "+r+":00:00";dd=Date.parse(futurestring)-Date.parse(h);dday=Math.floor(dd/864e5*1);dhour=Math.floor(dd%864e5/36e5*1);dmin=Math.floor(dd%864e5%36e5/6e4*1);dsec=Math.floor(dd%864e5%36e5%6e4/1e3*1);if(dsec<0){$(".countdown").hide();return null}dday=("0"+dday).slice(-2);dhour=("0"+dhour).slice(-2);dmin=("0"+dmin).slice(-2);dsec=("0"+dsec).slice(-2);$(".countdown h2.d span.digits").text(dday);$(".countdown h2.h span.digits").text(dhour);$(".countdown h2.m span.digits").text(dmin);$(".countdown h2.s span.digits").text(dsec)},feedInterval:null,twitterFeedPosition:0,instagramFeedPosition:0,getSocialFeed:function(){$.ajax("/api/socialfeed/composite",{success:function(e,t,n){function s(e){if(e=="twitter"){if(dash.twitterFeedPosition==r.length-1){dash.twitterFeedPosition=0;return 0}return++dash.twitterFeedPosition}if(e=="instagram"){if(dash.instagramFeedPosition==i.length-1){dash.instagramFeedPosition=0;return 0}return++dash.instagramFeedPosition}}var r=dash.parseData(e.tweets,"twitter"),i=dash.parseData(e.instagram,"instagram");dash.addTwitterFeedItem(r[s("twitter")],1);dash.addTwitterFeedItem(r[s("twitter")],2);dash.addTwitterFeedItem(r[s("twitter")],3);dash.addTwitterFeedItem(r[s("twitter")],4);dash.addTwitterFeedItem(r[s("twitter")],5);dash.addTwitterFeedItem(r[s("twitter")],6);dash.addInstagramFeedItem(i[s("instagram")]);$(".feed").animate({opacity:1});setInterval(function(){$(".feed").animate({opacity:0},function(){dash.addTwitterFeedItem(r[s("twitter")],1);dash.addTwitterFeedItem(r[s("twitter")],2);dash.addTwitterFeedItem(r[s("twitter")],3);dash.addTwitterFeedItem(r[s("twitter")],4);dash.addTwitterFeedItem(r[s("twitter")],5);dash.addTwitterFeedItem(r[s("twitter")],6);dash.addInstagramFeedItem(i[s("instagram")]);$(".feed").animate({opacity:1})})},3e4)}})},addTwitterFeedItem:function(e,t){if(!e)return;var n=$(".feed .twitter.d"+t);n.find(".content").html(e.content);n.find(".content").parent("a").attr("href",e.link);n.find(".network-icon").parent("a").attr("href",e.link);n.find("a .content").css({"margin-top":-n.find(".content").height()/2})},addInstagramFeedItem:function(e){if(!e)return;var t=$(".feed .instagram");t.addClass("instagram");t.find(".network-icon").remove();t.find(".instagram-tag").show();t.find(".content").html('<img src="'+e.image_src.replace("http://","//")+'" />');t.find(".content").parent("a").attr("href",e.link)},parseData:function(e,t){var n=[];t=="twitter"?$.each(e,function(e,t){n.push({type:"tweet",content:dash.replaceURLWithHTMLLinks(t.text),timestamp:new Date(Date.parse(t.created_at)),link:"https://twitter.com/"+t.user.screen_name+"/status/"+t.id_str})}):t=="instagram"&&$.each(e,function(e,t){n.push({type:"instagram",image_src:t.images.low_resolution.url,timestamp:new Date(t.created_time*1e3),link:t.link})});var r=_.sortBy(n,function(e){return e.timestamp});return r},replaceURLWithHTMLLinks:function(e){var t=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig;return e.replace(t,'<a class="url" href="$1" target="_blank">$1</a>')},initHowToPlay:function(){var e=$("#how-to-play-modal"),t=info.ismobile?"mobile/":"";a=1;i.on("click",this.showHowToPlay);e.find(".toolbar > img").on("click",function(){a=Number(e.find(".modal-content-ctr").attr("seq"));if(a<3){e.find(".modal-content-ctr > img").attr("src","/media/"+t+"images/dashboard/how-to-play/"+(a+1)+".jpg");e.find(".modal-content-ctr").attr("seq",a+1);info.ismobile&&window.scrollTo(0,0);a+1==3&&e.find(".toolbar img").attr("src","/media/"+t+"images/dashboard/how-to-play/ready-btn.png")}else hideModal(e,function(){activities.initSpeedbump();return})});e.find(".title .close").on("click",function(){hideModal(e,function(){activities.initSpeedbump()})})},showHowToPlay:function(){var e=$("#how-to-play-modal"),t=info.ismobile?"mobile/":"";showModal(e);a=1;e.find(".modal-content-ctr").attr("seq",1);e.find(".modal-content-ctr > img").attr("src","/media/"+t+"images/dashboard/how-to-play/"+a+".jpg");e.find(".toolbar img").attr("src","/media/"+t+"images/dashboard/how-to-play/next-btn.png");gaEvent("howtoplay")},markActivityComplete:function(e,t,n){if(!e||!t||n<0)return;var r=$(".activity[activity-type="+e+"][activity-id="+t+"] .finished-indicator");$(".activity[activity-type="+e+"][activity-id="+t+"]").addClass("completed");r.addClass("checked");r.text(numberWithCommas(n)+" pts");dash.addPoints(n)},addPoints:function(e){e=Number(e);info.user.total_weekpoints=Number(info.user.total_weekpoints)+e;info.user.points_total=Number(info.user.points_total)+e;o.text(numberWithCommas(info.user.points_total));dashboardAnim.drawPoints(info.user.total_weekpoints);var t=$(".notification-qty"),n=Number(t.text());t.text(++n)},initRecruit:function(){$(".recruit-ctr .leftarrow, .recruit-ctr .rightarrow").on("click",function(){var e=$(".recruit-ctr .network-frame img"),t=e.attr("platform");if(t=="facebook"){e.attr("src","/media/images/dashboard/recruit-twitter.png");e.attr("platform","twitter")}else{e.attr("src","/media/images/dashboard/recruit-facebook.png");e.attr("platform","facebook")}});$(".recruit-ctr .network-frame").on("click",function(e){dash.shareApp($(e.target).attr("platform"))})},updateUserRank:function(e){info.ismobile||u.text(e)}}}();var dash=new Dashboard;if(typeof executeOnLoad=="undefined")var executeOnLoad=[];executeOnLoad.push(function(){dash.init();gaPage("dashboard");$("toolbar img, .recruit-drivers img").css("cursor","default")});