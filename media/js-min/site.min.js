var landing={accessToken:null,$ageGate:null,init:function(){landing.initEventHandlers();landing.$ageGate=$("#age-gate");$(".trailer").click(function(){$.fancybox({padding:0,autoScale:!1,transitionIn:"none",transitionOut:"none",title:this.title,href:this.href,type:"iframe",swf:{wmode:"transparent",allowfullscreen:"true"},beforeLoad:function(){}});gaEvent("landing-trailer");return!1});var e=$(".carbon").customSelect();if(readCookie("ineligible")){$("#landing").hide();$("#ineligible").show();return}$(".social-btns area").on("mousedown",function(){$(this).attr("alt")=="Twitter"&&gaEvent("follow_twitter");$(this).attr("alt")=="Facebook"&&gaEvent("follow_fb");$(this).attr("alt")=="Instagram"&&gaEvent("follow_instagram")})},start:function(){FB.getLoginStatus(function(e){if(e.status==="connected"){var t=e.authResponse.userID;landing.accessToken=e.authResponse.accessToken;document.URL.indexOf("?mobile")!=-1?window.location.href="/main/start?a="+landing.accessToken+"&mobile":window.location.href="/main/start?a="+landing.accessToken}else e.status==="not_authorized"})},transition:function(e,t){window.scrollTo(0,0);var n=$(".wrapper:visible");t?$(n).fadeOut(250,function(){$(e).css({left:0,opacity:1}).fadeIn(250)}):$(n).animate({left:-100,opacity:0},250,function(){$(n).hide();$(e).css({left:100,opacity:0}).show().animate({left:0,opacity:1},250)})},initEventHandlers:function(){function e(e){var t=e.split("-");return new Date(t[0],t[1]-1,t[2])}function t(){$(".error").hide();var t=landing.$ageGate;t.find(".opt-ins input[name=terms]").parents("label").css({color:"inherit"});var n=$("form input[name=email]").val(),r=$("form select[name=month]").val(),i=$("form select[name=day]").val(),s=$("form select[name=year]").val(),o=$("form input[name=optin]").is(":checked"),u=$("form input[name=terms]").is(":checked"),a=!0;if(!n){t.find(".email-ctr .error").slideDown("fast");a=!1}if(!/^[a-zA-Z0-9._%+-]+?@[a-zA-Z0-9.-]+?\.[a-zA-Z]{2,3}$/.test(n)){t.find(".email-ctr .error").slideDown("fast");a=!1}if(!r||!i||!s){t.find(".dob-ctr .error").slideDown("fast");a=!1}if(!u){t.find(".opt-ins input[name=terms]").parents("label").css({color:"red"});a=!1}if(a){var f=e(s+"-"+r+"-"+i),l=Math.abs(new Date-f),c=4102e8;if(l<c){createCookie("ineligible",!0,1e3);landing.transition("#ineligible");gaEvent("failed_age_gate");return}landing.addUser({access_token:FB.getAccessToken(),opt_communication:function(){return landing.$ageGate.find("input[name=terms]").is(":checked")?"yes":"no"},email:n,dob:f.getFullYear()+"-"+(f.getMonth()+1)+"-"+f.getDate(),agree_sweeps:function(){return landing.$ageGate.find("input[name=terms]").is(":checked")?"yes":"no"},agree_weekly:function(){return landing.$ageGate.find("input[name=weekly]").is(":checked")?"yes":"no"}})}gaEvent("submit")}$(".close").on("click",function(e){if($(this).parents(".modal")[0].id!="picture-public-modal"){e.stopPropagation();e.preventDefault();landing.$ageGate.find(".error").hide();$("input[type=checkbox]").parents("label").css({color:"inherit"});$("input[type=checkbox]").attr("checked",!1);landing.transition("#landing",!0)}});$(".join").on("click",function(e){e.stopPropagation();e.preventDefault();landing.transition("#age-gate");gaPage("instructions");gaEvent("join_the_race")});$(".create-account").on("click",function(){landing.transition("#age-gate");gaPage("age_gate");gaEvent("prequalify")});$(".go-to-dash").on("click",function(){landing.start()});$(".returning").on("click",function(e){e.stopPropagation();e.preventDefault();landing.transition("#reconnect")});$(".facebook-connect").on("click",function(e){e.stopPropagation();e.preventDefault();gaEvent("returning_user");loadMask("#reconnect");FB.login(function(e){e.authResponse&&$.ajax({url:"/api/landing/lookupuser",type:"POST",data:{access_token:FB.getAccessToken()},complete:function(e,t){removeMask("#reconnect");if(t=="error"||$.isEmptyObject(e))return;if(e.responseJSON.user===undefined||!e.responseJSON.user){landing.transition("#age-gate");return}var n=!1,r=!1;e.responseJSON.user.agree_sweeps=="yes"&&(n=!0);e.responseJSON.user.agree_weekly=="yes"&&(r=!0);if(n&&r){loadMask("body");landing.start()}else if(n&&!r)landing.transition("#sweepstakes");else{$("#repermission .name").text(", "+e.responseJSON.user.firstname);landing.transition("#repermission")}}})})});$(".repermission-submit").on("click",function(e){$("#transition label").css({color:"inherit"});if(!$("#repermission input[name=terms]").is(":checked")){$("#repermission input[name=terms]").parents("label").css({color:"red"});return}loadMask("#repermission");$.ajax({url:"/api/landing/updateuser",type:"POST",data:{access_token:FB.getAccessToken(),agree_sweeps:function(){return $("#repermission input[name=terms]").is(":checked")?"yes":"no"},agree_weekly:function(){return $("#repermission input[name=weekly]").is(":checked")?"yes":"no"}},complete:function(e,t){removeMask("#repermission");if(t=="success"){if($("#repermission input[name=terms]").is(":checked")){if($("#repermission input[name=weekly]").is(":checked")){landing.transition("#transition");return}landing.transition("#sweepstakes")}}else alert("An error occurred. Please try again later.")}});gaEvent("repermission")});$(".sweepstakes-submit").on("click",function(e){$("#sweepstakes label").css({color:"inherit"});if(!$("#sweepstakes input[name=weekly]").is(":checked")){$("#sweepstakes input[name=weekly]").parents("label").css({color:"red"});return}loadMask("#sweepstakes");$.ajax({url:"/api/landing/updateuser",type:"POST",data:{access_token:FB.getAccessToken(),agree_sweeps:"yes",agree_weekly:"yes"},complete:function(e,t){removeMask("#sweepstakes");if(t=="success"){if(e.responseJSON.phase==1)landing.transition("#transition");else if(e.responseJSON.phase==2){loadMask("body");landing.start()}}else alert("An error occurred. Please try again later.")}})});$(".transition-join").on("click",function(e){loadMask("body");landing.start()});$("form[name=register]").on("submit",function(e){e.preventDefault();t()});$(".submit").on("click",function(e){e.stopPropagation();e.preventDefault();t()})},addUser:function(e){FB.login(function(t){if(t.authResponse){e.access_token=t.authResponse.accessToken;loadMask("#age-gate");$.ajax({url:"/api/landing/adduser",data:e,type:"post",dateType:"json",complete:function(t,n){removeMask("#age-gate");if(n=="success")if(t.responseJSON.phase!==undefined){if(e.agree_sweeps()=="yes"&&e.agree_weekly()=="no"){landing.transition("#sweepstakes");return}if(e.agree_sweeps()=="yes"&&e.agree_weekly()=="yes"){landing.transition("#transition");return}}else{if(e.agree_sweeps()=="yes"&&e.agree_weekly()=="no"){landing.transition("#sweepstakes");return}if(e.agree_sweeps()=="yes"&&e.agree_weekly()=="yes"){loadMask("body");landing.start();return}}else n=="error"&&alert("An error occurred. Please try again later.")}})}else gaEvent("incomplete_fb_authorization")});gaEvent("addUser")},spinner:null,loadMask:function(e){$(e).append('<div class="load-overlay"></div>');$(e+" .load-overlay").fadeIn(function(){landing.spinner=(new Spinner({color:"#ddd",shadow:!0})).spin($(e).get(0))})},removeMask:function(e){$(e).find(".load-overlay").remove();try{landing.spinner.stop()}catch(t){setTimeout(function(){landing.spinner.stop()},500)}}};if(typeof executeOnLoad=="undefined")var executeOnLoad=[];executeOnLoad.push(function(){landing.init();$("body").hasClass("index")&&gaPage("landing")});